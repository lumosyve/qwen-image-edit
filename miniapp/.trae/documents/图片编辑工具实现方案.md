# 图片编辑工具实现方案

## 一、功能需求

1. **图片上传**：支持上传1-3张照片
2. **Prompt输入**：支持自定义输入，提供示例Prompt分类选择
3. **参数配置**：支持配置image_size、batch_size、num_inference_steps、guidance_scale等参数
4. **AI调用**：调用Qwen/Qwen-Image-Edit-2509模型生成图片
5. **结果展示**：展示生成的图片，支持点击预览

## 二、技术架构

### 1. 页面结构

- **首页**：修改现有首页，添加图片编辑工具入口
- **图片编辑页**：包含图片上传、Prompt输入、参数配置、生成按钮和结果展示
- **图片预览页**：用于预览生成的图片

### 2. 文件结构

```
├── src/
│   ├── pages/
│   │   ├── index/              # 首页
│   │   │   └── index.vue
│   │   ├── image-edit/         # 图片编辑页
│   │   │   └── image-edit.vue
│   │   └── image-preview/      # 图片预览页
│   │       └── image-preview.vue
│   ├── components/             # 组件
│   │   ├── image-uploader.vue  # 图片上传组件
│   │   ├── prompt-selector.vue # Prompt选择组件
│   │   └── param-config.vue    # 参数配置组件
│   ├── utils/                  # 工具类
│   │   ├── api.ts              # API调用封装
│   │   └── constants.ts        # 常量定义
│   ├── static/                 # 静态资源
│   └── pages.json              # 页面配置
```

### 3. 核心功能实现

#### 3.1 首页改造

- 添加图片编辑工具入口卡片
- 点击跳转到图片编辑页

#### 3.2 图片编辑页

1. **图片上传区域**
   - 使用uni-app的upload组件实现图片上传
   - 限制上传数量1-3张
   - 支持预览和删除已上传图片

2. **Prompt输入区域**
   - 文本输入框用于自定义Prompt
   - 示例Prompt分类选择（人像处理、图像处理、色彩、风格、质感、细节等）
   - 点击示例自动填充到输入框

3. **参数配置区域**
   - 图片尺寸选择（1328x1328、1664x928等）
   - 生成数量选择（batch_size）
   - 推理步数选择（num_inference_steps）
   - 引导尺度选择（guidance_scale）

4. **生成按钮**
   - 点击调用AI接口
   - 显示加载状态

5. **结果展示区域**
   - 网格布局展示生成的图片
   - 点击图片跳转到预览页

#### 3.3 API调用封装

- 封装SiliconFlow API调用
- 处理请求和响应
- 错误处理

#### 3.4 示例Prompt配置

```javascript
// utils/constants.ts

export const PROMPT_EXAMPLES = {
  人像处理: [
    "一键美颜，自然美白，光滑肌肤",
    "瘦脸瘦身，优化脸型，提升气质",
    "增强眼睛细节，放大双眼，提亮眼神",
    "调整肤色，均匀肤质，去除瑕疵"
  ],
  图像处理: [
    "增强图像清晰度，提升细节",
    "调整对比度，优化色彩平衡",
    "去除图像噪点，平滑画面",
    "修复老照片，恢复清晰度"
  ],
  色彩: [
    "转为暖色调，增加温馨感",
    "转为冷色调，提升高级感",
    "增强色彩饱和度，使画面更鲜艳",
    "调整色调，营造特定氛围"
  ],
  风格: [
    "转为油画风格，艺术感十足",
    "转为水彩画风格，清新自然",
    "转为素描风格，简约大气",
    "转为赛博朋克风格，科技感强烈"
  ],
  质感: [
    "增加质感，使画面更有层次",
    "提升锐度，增强细节表现",
    "增加光晕效果，营造梦幻感",
    "添加纹理，使画面更丰富"
  ],
  细节: [
    "增强细节，提升画面清晰度",
    "修复细节，完善画面内容",
    "突出主体，虚化背景",
    "调整构图，优化画面比例"
  ]
};
```

#### 3.5 参数配置选项

```javascript
// utils/constants.ts

export const IMAGE_SIZES = [
  { label: "1:1 (1328x1328)", value: "1328x1328" },
  { label: "16:9 (1664x928)", value: "1664x928" },
  { label: "9:16 (928x1664)", value: "928x1664" },
  { label: "4:3 (1472x1140)", value: "1472x1140" },
  { label: "3:4 (1140x1472)", value: "1140x1472" },
  { label: "3:2 (1584x1056)", value: "1584x1056" },
  { label: "2:3 (1056x1584)", value: "1056x1584" }
];

export const BATCH_SIZES = [1, 2, 3, 4];

export const INFERENCE_STEPS = [20, 30, 40, 50, 60, 70, 80, 90, 100];

export const GUIDANCE_SCALES = [5.0, 6.0, 7.0, 7.5, 8.0, 9.0, 10.0];
```

## 三、页面路由配置

```json
// pages.json
{
  "pages": [
    {
      "path": "pages/index/index",
      "style": {
        "navigationBarTitleText": "工具首页"
      }
    },
    {
      "path": "pages/image-edit/image-edit",
      "style": {
        "navigationBarTitleText": "图片编辑"
      }
    },
    {
      "path": "pages/image-preview/image-preview",
      "style": {
        "navigationBarTitleText": "图片预览",
        "enablePullDownRefresh": false
      }
    }
  ],
  "globalStyle": {
    "navigationBarTextStyle": "black",
    "navigationBarTitleText": "工具类小程序",
    "navigationBarBackgroundColor": "#F8F8F8",
    "backgroundColor": "#F8F8F8"
  }
}
```

## 四、核心代码实现

### 1. API调用封装

```typescript
// utils/api.ts

const API_KEY = 'YOUR_API_KEY'; // 建议从环境变量获取
const API_URL = 'https://api.siliconflow.cn/v1/images/generations';

export interface ImageEditParams {
  model: string;
  prompt: string;
  image?: string;
  image2?: string;
  image3?: string;
  image_size: string;
  batch_size: number;
  num_inference_steps: number;
  guidance_scale: number;
  seed?: number;
}

export interface ImageEditResult {
  images: Array<{
    url: string;
  }>;
  timings: any;
  seed: number;
}

export async function editImage(params: ImageEditParams): Promise<ImageEditResult> {
  try {
    const response = await uni.request({
      url: API_URL,
      method: 'POST',
      header: {
        'Authorization': `Bearer ${API_KEY}`,
        'Content-Type': 'application/json'
      },
      data: params
    });
    
    if (response.statusCode === 200) {
      return response.data as ImageEditResult;
    } else {
      throw new Error(`API请求失败：${response.statusCode}`);
    }
  } catch (error) {
    console.error('图片编辑API调用失败:', error);
    throw error;
  }
}
```

### 2. 图片编辑页核心逻辑

```vue
<!-- pages/image-edit/image-edit.vue -->

<template>
  <view class="image-edit-container">
    <!-- 图片上传区域 -->
    <image-uploader 
      :max-count="3" 
      @change="handleImagesChange" 
    />
    
    <!-- Prompt输入区域 -->
    <prompt-selector @select="handlePromptSelect" />
    <textarea 
      v-model="prompt" 
      placeholder="请输入Prompt或选择示例"
      class="prompt-input"
    ></textarea>
    
    <!-- 参数配置区域 -->
    <param-config 
      v-model="params" 
    />
    
    <!-- 生成按钮 -->
    <button 
      class="generate-btn" 
      @click="generateImages"
      :disabled="isGenerating"
    >
      {{ isGenerating ? '生成中...' : '生成图片' }}
    </button>
    
    <!-- 结果展示区域 -->
    <view class="result-container" v-if="generatedImages.length > 0">
      <view class="result-title">生成结果</view>
      <view class="image-grid">
        <view 
          class="image-item" 
          v-for="(image, index) in generatedImages" 
          :key="index"
          @click="previewImage(image.url)"
        >
          <image :src="image.url" mode="aspectFill" class="result-image" />
        </view>
      </view>
    </view>
  </view>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue';
import ImageUploader from '@/components/image-uploader.vue';
import PromptSelector from '@/components/prompt-selector.vue';
import ParamConfig from '@/components/param-config.vue';
import { editImage } from '@/utils/api';

const images = ref<string[]>([]);
const prompt = ref('');
const params = reactive({
  image_size: '1328x1328',
  batch_size: 1,
  num_inference_steps: 20,
  guidance_scale: 7.5
});
const isGenerating = ref(false);
const generatedImages = ref<Array<{ url: string }>>([]);

const handleImagesChange = (newImages: string[]) => {
  images.value = newImages;
};

const handlePromptSelect = (selectedPrompt: string) => {
  prompt.value = selectedPrompt;
};

const generateImages = async () => {
  if (images.value.length === 0) {
    uni.showToast({ title: '请至少上传一张图片', icon: 'none' });
    return;
  }
  
  if (!prompt.value) {
    uni.showToast({ title: '请输入或选择Prompt', icon: 'none' });
    return;
  }
  
  isGenerating.value = true;
  
  try {
    const requestParams = {
      model: 'Qwen/Qwen-Image-Edit-2509',
      prompt: prompt.value,
      image: images.value[0],
      image2: images.value[1],
      image3: images.value[2],
      ...params
    };
    
    const result = await editImage(requestParams);
    generatedImages.value = result.images;
  } catch (error) {
    uni.showToast({ title: '生成失败，请重试', icon: 'none' });
  } finally {
    isGenerating.value = false;
  }
};

const previewImage = (url: string) => {
  uni.navigateTo({
    url: `/pages/image-preview/image-preview?url=${encodeURIComponent(url)}`
  });
};
</script>
```

## 五、UI设计建议

1. **整体风格**：简洁、现代，符合小程序设计规范
2. **色彩方案**：主色调使用蓝色系，辅助色使用灰色系
3. **布局设计**：
   - 采用垂直流式布局
   - 各功能区域之间有明确的分隔
   - 按钮和可交互元素有明显的视觉反馈
4. **响应式设计**：适配不同屏幕尺寸的设备

## 六、注意事项

1. **API密钥安全**：建议将API密钥存储在安全的地方，避免硬编码在代码中
2. **图片格式处理**：确保上传的图片格式符合API要求（base64或URL）
3. **错误处理**：添加完善的错误提示和异常处理
4. **性能优化**：
   - 图片上传前进行压缩
   - 生成过程中显示加载状态
   - 结果图片懒加载
5. **用户体验**：
   - 添加操作指引
   - 示例Prompt分类清晰
   - 参数配置提供默认值

## 七、后续扩展

1. 支持图片下载功能
2. 添加历史记录功能
3. 支持更多AI模型选择
4. 添加图片对比功能
5. 支持生成过程的实时进度展示

以上是图片编辑工具的完整实现方案，按照该方案可以实现一个功能完整、用户体验良好的图片编辑工具。